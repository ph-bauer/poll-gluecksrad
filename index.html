<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pizza Fee Game</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#1b0f2a;
      --card:#0f172a;
      --card2:#111c36;
      --text:#e9eefc;
      --muted:#a9b4d6;
      --stroke:rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --a1:#ff4d6d;
      --a2:#ffd166;
      --b1:#4cc9f0;
      --b2:#80ffdb;
      --ok:#7CFF6B;
      --warn:#ffb703;
      --bad:#ff5d5d;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      padding:18px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(255,77,109,.28), transparent 55%),
        radial-gradient(1200px 800px at 85% 20%, rgba(76,201,240,.24), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .wrap{ width:min(860px, 100%); }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(900px 300px at 10% 0%, rgba(255,209,102,.18), transparent 60%),
        radial-gradient(900px 300px at 90% 0%, rgba(76,201,240,.16), transparent 60%);
      pointer-events:none;
    }

    header{
      position:relative;
      padding:18px 18px 12px;
      border-bottom:1px solid var(--stroke);
    }

    .top{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
    }

    .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.25;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(15,23,42,.55);
      backdrop-filter: blur(8px);
      font-weight:700;
      font-size:13px;
      white-space:nowrap;
    }
    .dot{
      width:9px; height:9px; border-radius:999px;
      background: conic-gradient(from 0deg, var(--a1), var(--a2), var(--b1), var(--b2), var(--a1));
      box-shadow: 0 0 18px rgba(255,255,255,.35);
    }

    main{ position:relative; padding:16px 18px 18px; }

    .sectionTitle{
      margin:0 0 10px;
      font-size:15px;
      color:var(--text);
      font-weight:800;
      letter-spacing:.2px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width:780px){
      .grid{ grid-template-columns: 1.15fr .85fr; align-items:start; }
    }

    .row{ display:flex; gap:12px; flex-wrap:wrap; }

    button{
      width:100%;
      padding:14px 14px;
      font-size:15px;
      font-weight:750;
      border-radius:16px;
      border:1px solid var(--stroke);
      color:var(--text);
      background: rgba(15,23,42,.55);
      backdrop-filter: blur(10px);
      cursor:pointer;
      transition: transform .06s ease, border-color .15s ease, filter .15s ease;
      text-align:left;
      line-height:1.2;
    }
    button:active{ transform: scale(.99); }
    button:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

    .btnA{
      background:
        linear-gradient(135deg, rgba(255,77,109,.30), rgba(255,209,102,.18)),
        rgba(15,23,42,.55);
      border-color: rgba(255,209,102,.28);
    }
    .btnB{
      background:
        linear-gradient(135deg, rgba(76,201,240,.26), rgba(128,255,219,.14)),
        rgba(15,23,42,.55);
      border-color: rgba(76,201,240,.28);
    }

    .mini{ font-size:12px; color:var(--muted); font-weight:600; display:block; margin-top:6px; }

    .panel{
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:14px 14px;
      background: rgba(15,23,42,.45);
      backdrop-filter: blur(10px);
    }

    .outcomeTitle{ margin:0 0 8px; font-size:14px; font-weight:900; letter-spacing:.2px; }
    .outcomeText{ margin:0; font-size:14px; color:var(--text); line-height:1.25; }
    .muted{ margin:10px 0 0; color:var(--muted); font-size:12.5px; line-height:1.25; }

    canvas{ width:100%; max-width:520px; height:auto; display:block; margin: 10px auto 8px; }

    .center{ text-align:center; }

    .actionRow{
      display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
      margin-top:10px;
    }
    .actionRow button{ width:auto; min-width:140px; text-align:center; }

    .spinBtn{
      background:
        linear-gradient(135deg, rgba(124,255,107,.22), rgba(255,209,102,.14)),
        rgba(15,23,42,.55);
      border-color: rgba(124,255,107,.26);
    }

    .final{
      display:none;
      margin-top:14px;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    .final .big{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .final .small{
      margin:8px 0 0;
      font-size:12.5px;
      color:var(--muted);
      line-height:1.25;
    }

    .pizza{
      margin-top:10px;
      font-size:28px;
      letter-spacing:2px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.25));
    }

    .lockscreen{
      width:min(860px, 100%);
      border-radius:22px;
      border:1px solid var(--stroke);
      background: rgba(15,23,42,.55);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding:18px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.18);
      border:1px solid var(--stroke);
      font-weight:800;
      font-size:13px;
    }

    /* Added for the new feature: show final result on lock screen */
    .lockResult{
      margin-top:14px;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    .lockResult .title{
      margin:0 0 6px;
      font-size:14px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .lockResult .line{
      margin:0;
      font-size:13.5px;
      color:var(--text);
      line-height:1.25;
    }
    .lockResult .miniLine{
      margin:8px 0 0;
      font-size:12.5px;
      color:var(--muted);
      line-height:1.25;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="top">
          <div>
            <h1>üçï Pizza Fee Game</h1>
            <p class="sub">Pick an approach. If you choose <b>A</b>, you spin the pizza wheel. If you choose <b>B</b>, you get a regulated slice outcome.</p>
          </div>
          <div class="badge" id="scoreBadge"><span class="dot"></span> Slices: 0</div>
        </div>
      </header>

      <main>
        <!-- STEP 1 -->
        <h2 class="sectionTitle">Step 1) Which approach do you prefer?</h2>

        <div class="row">
          <button id="chooseA" class="btnA">
            A) American approach
            <span class="mini">Contingency fees are generally permitted</span>
          </button>

          <button id="chooseB" class="btnB">
            B) German approach
            <span class="mini">Contingency fees are generally prohibited</span>
          </button>
        </div>

        <!-- STEP 2A -->
        <div id="step2A" style="display:none; margin-top:16px;">
          <div class="grid">
            <div class="panel">
              <div class="outcomeTitle">Step 2) Spin the pizza wheel</div>
              <canvas id="wheel" width="520" height="520"></canvas>
              <div class="actionRow">
                <button id="spin" class="spinBtn">Spin</button>
              </div>
              <p class="muted center" style="margin-top:10px;">Outcome: either <b>+3 slices</b> (client wins) or <b>+0 slices</b> (client loses).</p>
            </div>

            <div class="panel">
              <div class="outcomeTitle">Your result</div>
              <p id="resultA" class="outcomeText">‚Äî</p>
              <div id="pizzaA" class="pizza center"></div>

              <div class="final" id="finalA">
                <p class="big" id="finalHeadlineA">Game over.</p>
                <p class="small">One run per device. Please show this screen to the presenter.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 2B -->
        <div id="step2B" style="display:none; margin-top:16px;">
          <div class="panel">
            <div class="outcomeTitle">Step 2) Automatic outcome</div>
            <p class="outcomeText" style="font-weight:900;">
              üçï You won <b>1 slice</b>
            </p>
            <p class="muted" style="margin-top:8px;">Predictable & regulated: contingency fees generally prohibited.</p>

            <div class="final" id="finalB" style="display:block;">
              <p class="big">Game over.</p>
              <p class="small">One run per device. Please keep this screen open and show it to the presenter.</p>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

<script>
  /**********************
   * CONFIG
   **********************/
  // Win probability for A (0..1). Keep 0.5 for 50/50.
  const WIN_PROBABILITY = 0.5;

  // One run per device/browser (no backend)
  const RUN_LOCK_KEY = "pizzaFeeGame_runCompleted_v2";
  const SCORE_KEY    = "pizzaFeeGame_slicesScore_v2";

  // NEW FEATURE: persist final result for lock screen
  const FINAL_RESULT_KEY = "pizzaFeeGame_finalResult_v1";

  // If you (presenter) ever need to unlock a device for testing:
  // open URL with ?unlock=1 once on that device.
  const params = new URLSearchParams(location.search);
  const unlock = params.get("unlock") === "1";

  if (unlock) {
    localStorage.removeItem(RUN_LOCK_KEY);
    localStorage.removeItem(SCORE_KEY);
    localStorage.removeItem(FINAL_RESULT_KEY); // NEW: clear stored final result too
    // remove query param for cleanliness
    params.delete("unlock");
    const newUrl = location.pathname + (params.toString() ? "?" + params.toString() : "");
    history.replaceState({}, "", newUrl);
  }

  const OUTCOMES = [
    { key:"win",  label: "üçïüçïüçï Hurray ‚Äî your client won the whole pizza!", slices: 3, pizzas: "üçïüçïüçï" },
    { key:"lose", label: "üôÉ Sorry ‚Äî your client lost. No pizza tonight.", slices: 0, pizzas: "" },
  ];

  /**********************
   * LOCK SCREEN (enhanced with final result)
   **********************/
  if (localStorage.getItem(RUN_LOCK_KEY) === "1") {
    let stored = null;
    try { stored = JSON.parse(localStorage.getItem(FINAL_RESULT_KEY) || "null"); } catch(e){ stored = null; }

    const headline = stored?.headline || "Game completed.";
    const detail   = stored?.detail   || "";
    const pizzas   = stored?.pizzas   || "";
    const slices   = (typeof stored?.slices === "number") ? stored.slices : null;

    document.body.innerHTML = `
      <div class="wrap">
        <div class="lockscreen">
          <div class="pill"><span class="dot"></span> One run per device</div>
          <h1 style="margin:12px 0 6px; font-size:18px;">Thanks for playing! üçï</h1>

          <div class="lockResult">
            <p class="title">${headline}</p>
            <p class="line">${slices !== null ? `Slices earned: <b>${slices}</b>` : ""}</p>
            ${detail ? `<p class="line" style="margin-top:6px;">${detail}</p>` : ""}
            ${pizzas ? `<div class="pizza center">${pizzas}</div>` : ""}
            <p class="miniLine">Please show this screen to the presenter.</p>
          </div>
        </div>
      </div>
    `;
    throw new Error("Run locked");
  }

  /**********************
   * STATE
   **********************/
  let score = Number(localStorage.getItem(SCORE_KEY) || "0");

  function setScore(newScore){
    score = newScore;
    localStorage.setItem(SCORE_KEY, String(score));
    scoreBadge.textContent = `Slices: ${score}`;
  }

  function lockRun(){
    localStorage.setItem(RUN_LOCK_KEY, "1");
  }

  // NEW FEATURE: store final result for lock screen recall
  function storeFinalResult({ headline, detail, pizzas, slices }){
    const payload = {
      headline: headline || "Game completed.",
      detail: detail || "",
      pizzas: pizzas || "",
      slices: (typeof slices === "number") ? slices : null,
      ts: Date.now()
    };
    localStorage.setItem(FINAL_RESULT_KEY, JSON.stringify(payload));
  }

  /**********************
   * UI
   **********************/
  const scoreBadge = document.getElementById("scoreBadge");
  const chooseA = document.getElementById("chooseA");
  const chooseB = document.getElementById("chooseB");
  const step2A  = document.getElementById("step2A");
  const step2B  = document.getElementById("step2B");

  const resultA = document.getElementById("resultA");
  const pizzaA  = document.getElementById("pizzaA");
  const finalA  = document.getElementById("finalA");
  const finalHeadlineA = document.getElementById("finalHeadlineA");

  setScore(score);

  function disableChoices(){
    chooseA.disabled = true;
    chooseB.disabled = true;
  }

  function showA(){
    disableChoices();
    step2A.style.display = "block";
    step2B.style.display = "none";
    drawWheel();
    resultA.textContent = "Tap Spin to find out‚Ä¶";
    pizzaA.textContent = "";
    finalA.style.display = "none";
  }

  function showB(){
    disableChoices();
    step2B.style.display = "block";
    step2A.style.display = "none";

    // Automatic outcome: +1 slice
    setScore(score + 1);

    // NEW FEATURE: store final result (B)
    storeFinalResult({
      headline: "üçï You won 1 slice",
      detail: "Predictable & regulated: contingency fees generally prohibited.",
      pizzas: "üçï",
      slices: 1
    });

    // Lock run and keep screen visible (inputs disabled)
    lockRun();
  }

  chooseA.addEventListener("click", showA);
  chooseB.addEventListener("click", showB);

  /**********************
   * WHEEL
   **********************/
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");

  let angle = 0;
  let spinning = false;

  const spinBtn = document.getElementById("spin");

  function drawWheel(){
    const W = canvas.width, H = canvas.height;
    const cx = W/2, cy = H/2;
    const r = Math.min(W,H)/2 - 12;

    ctx.clearRect(0,0,W,H);

    const step = (Math.PI*2)/OUTCOMES.length;

    for (let i=0; i<OUTCOMES.length; i++){
      const a0 = angle + i*step;
      const a1 = a0 + step;

      ctx.beginPath();
      ctx.moveTo(cx,cy);
      ctx.arc(cx,cy,r,a0,a1);
      ctx.closePath();

      // colorful segments
      const grad = ctx.createLinearGradient(cx - r, cy - r, cx + r, cy + r);
      if (i === 0) { // win
        grad.addColorStop(0, "rgba(255,77,109,.85)");
        grad.addColorStop(1, "rgba(255,209,102,.85)");
      } else { // lose
        grad.addColorStop(0, "rgba(76,201,240,.70)");
        grad.addColorStop(1, "rgba(17,28,54,.85)");
      }
      ctx.fillStyle = grad;
      ctx.fill();

      ctx.strokeStyle = "rgba(255,255,255,.22)";
      ctx.lineWidth = 2;
      ctx.stroke();

      // text
      ctx.save();
      ctx.translate(cx,cy);
      ctx.rotate(a0 + step/2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#0b1020";
      ctx.font = "700 15px system-ui";
      ctx.fillText(i === 0 ? "WIN +3" : "LOSE +0", r - 18, 6);
      ctx.restore();
    }

    // outer ring
    ctx.beginPath();
    ctx.arc(cx,cy,r,0,Math.PI*2);
    ctx.strokeStyle = "rgba(255,255,255,.22)";
    ctx.lineWidth = 3;
    ctx.stroke();

    // pointer
    ctx.beginPath();
    ctx.moveTo(cx, cy - r - 2);
    ctx.lineTo(cx - 12, cy - r - 26);
    ctx.lineTo(cx + 12, cy - r - 26);
    ctx.closePath();
    ctx.fillStyle = "#e9eefc";
    ctx.fill();
  }

  function outcomeFromAngle(){
    const step = (Math.PI*2)/OUTCOMES.length;
    const pointerAngle = -Math.PI/2; // top
    let a = (pointerAngle - angle) % (Math.PI*2);
    if (a < 0) a += Math.PI*2;
    const idx = Math.floor(a / step);
    return OUTCOMES[idx];
  }

  function pickTargetAngleForOutcome(outcomeIndex){
    const step = (Math.PI*2)/OUTCOMES.length;
    const pointerAngle = -Math.PI/2;
    const epsilon = 0.2 * step + Math.random() * 0.6 * step;
    return pointerAngle - (outcomeIndex * step + epsilon);
  }

  spinBtn.addEventListener("click", () => {
    if (spinning) return;
    spinning = true;
    spinBtn.disabled = true;
    resultA.textContent = "Spinning‚Ä¶";
    pizzaA.textContent = "";
    finalA.style.display = "none";

    // Decide outcome by probability
    const win = Math.random() < WIN_PROBABILITY;
    const chosenIndex = win ? 0 : 1;

    const durationMs = 2100 + Math.random()*800;
    const start = performance.now();
    const startAngle = angle;

    const extraSpins = 7 + Math.random()*6;
    const targetNormalized = pickTargetAngleForOutcome(chosenIndex);

    const target = startAngle
      + extraSpins * Math.PI*2
      + (targetNormalized - (startAngle % (Math.PI*2)));

    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    function tick(now){
      const t = Math.min(1, (now - start) / durationMs);
      angle = startAngle + (target - startAngle) * easeOutCubic(t);
      drawWheel();

      if (t < 1){
        requestAnimationFrame(tick);
      } else {
        spinning = false;

        const out = outcomeFromAngle();
        resultA.textContent = `${out.label}  (+${out.slices} slices)`;
        pizzaA.textContent = out.pizzas;

        setScore(score + out.slices);

        // NEW FEATURE: store final result (A)
        storeFinalResult({
          headline: out.label,
          detail: out.key === "win"
            ? "Risky, but it paid off under the American approach."
            : "Risky outcome under the American approach.",
          pizzas: out.pizzas,
          slices: out.slices
        });

        // Lock run and freeze inputs (keep result visible)
        lockRun();
        chooseA.disabled = true;
        chooseB.disabled = true;
        spinBtn.disabled = true;

        finalHeadlineA.textContent = out.key === "win" ? "Nice! üçï" : "Ouch. üôÉ";
        finalA.style.display = "block";
      }
    }

    requestAnimationFrame(tick);
  });

  // initial render
  drawWheel();
</script>
</body>
</html>


